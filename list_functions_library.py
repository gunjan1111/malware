#!/usr/bin/env python

try:
        import os
        import sys
        import pefile
        import argparse
except  ImportError,err:
        import sys
        print >> sys.stderr, err
        sys.exit(1)

class EXE:

        result = {}

        @staticmethod
        def print_info(file_path, function, library):

                pe =  pefile.PE(file_path)
                for entry in pe.DIRECTORY_ENTRY_IMPORT:
                        function_list = []
                        for imp in entry.imports:
                                function_list.append(imp.name)
                        EXE.result[entry.dll] = function_list


        @staticmethod
        def main():

                description = "List Pe Information all about exe"
                usage = "Usage: use --help for futher information"
                parser = argparse.ArgumentParser(description = description, usage = usage)
                parser.add_argument('-e', '--filepath', dest = 'filepath', help = 'File Path', required = True)
                parser.add_argument('-f', '--function', dest = 'function', action = 'store_true', help = 'List Function Names', default=None)
                parser.add_argument('-l', '--library', dest = 'library', action = 'store_true', help = 'List Library Names', default=None)

                args = parser.parse_args()
                EXE.print_info(args.filepath, args.function, args.library)

                if ( not args.library is None) or ( not args.function is None):
                        for section in EXE.result.keys():
                                if args.library is None:
                                        print EXE.result[section]
                                elif args.function is None:
                                        print section
                                else:
                                        print "%s: %s"% (section, EXE.result[section])
##
### Main ...
##

if __name__ == "__main__":

        try:
                EXE.main()
        except Exception, err:
                print >> sys.stderr, err
                sys.exit(1)
