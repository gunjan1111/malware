#!/usr/bin/env python

try:
        import os
        import sys
        import pefile
        import argparse
except  ImportError,err:
        import sys
        print >> sys.stderr, err
        sys.exit(1)

class EXE:

        @staticmethod
        def print_info(file_path, function, library):

                pe =  pefile.PE(file_path)
                for entry in pe.DIRECTORY_ENTRY_IMPORT:
                        if library is not None:
                                print entry.dll
                        if function is not None:
                                for imp in entry.imports:
                                        if library is not None:
                                                print '\t',imp.name
                                        else:
                                                print imp.name

        @staticmethod
        def main():

                description = "List Pe Information all about exe"
                usage = "Usage: use --help for futher information"
                parser = argparse.ArgumentParser(description = description, usage = usage)
                parser.add_argument('-e', '--filepath', dest = 'filepath', help = 'File Path', required = True)
                parser.add_argument('-f', '--function', dest = 'function', action = 'store_true', help = 'List Function Names', default=None)
                parser.add_argument('-l', '--library', dest = 'library', action = 'store_true', help = 'List Library Names', default=None)

                args = parser.parse_args()
                EXE.print_info(args.filepath, args.function, args.library)

if __name__ == "__main__":

        try:
                EXE.main()
        except Exception, err:
                print >> sys.stderr, err
                sys.exit(1)
